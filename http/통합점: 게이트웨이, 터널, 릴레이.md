# 8. 통합점: 게이트웨이, 터널, 릴레이
> 게이트웨이 : 서로 다른 프로토콜과 애플리케이션 간의 HTTP 인터페이스다. <br>
> 애플리케이션 인터페이스 : 서로 다른 형식의 웹 애플리케이션이 통신하는 데 사용한다. <br>
> 터널 : HTTP 커넥션을 통해서 HTTP가 아닌 트래픽을 전송하는 데 사용한다. <br>
> 릴레이 : 일종의 단순한 HTTP 프락시로, 한 번에 한 개의 홉에 데이터를 전달하는데 사용한다. 


## 8.1. 게이트웨이
- 모든 리소스를 한 개의 애플리케이션으로만 처리 할 수 없다는 것에 근간으로 인터프리터 같이 리소스를 받기 위한 경로를 안내하는 역할을 하는 게이트웨이 고안
- 리소스와 애플리케이션을 연결하는 역할
- 요청을 받고 응답을 보내는 포털 가이 동작하는데, 동적인 콘텐츠를 생성하거나 데이터베잉스에 질의를 보낼 수 있음 
<img src = "https://image.slidesharecdn.com/chap8-160326041513/95/chap8-http-8-3-638.jpg?cb=1458965797">
- HTTP 트래픽을 다른 프로토콜로 자동으로 변환하여, HTTP 클라이언트가 다른 프로토콜을 알 필요없이 서버에 접속할 수 있게 함
<img src = "https://image.slidesharecdn.com/chap8-160326041513/95/chap8-http-8-4-638.jpg?cb=1458965797">

### 8.1.1. 클라이언트 측 게이트웨이와 서버 측 게이트웨이
- 서버 측 게이트웨이는 클라이언트와 HTTP로 통신하고, 서버와 외래 프로토콜로 통신한다.
- 클라이언트 측 게이트웨이는 클라이언트와 외래 프로토콜로 통신하고, 서버와는 HTTP로 통신한다.


## 8.2. 프로토콜 게이트웨이
- 게이트웨이에도 프락시처럼 트래픽을 바로 보낼수 있음<br>
<img src = "https://image.slidesharecdn.com/chap8-160326041513/95/chap8-http-8-7-638.jpg?cb=1458965797">

### 8.2.1. HTTP/*: 서버 측 웹 게이트웨이
- 서버 측 웹 게이트웨이는 클라이언트로부터 HTTP 요청이 원 서버 영역으로 들어오는 시점에 클라이언트 측의 HTTP 요청을 외래 프로토콜로 전환
<img src = "https://image.slidesharecdn.com/chap8-160326041513/95/chap8-http-8-9-638.jpg?cb=1458965797">
- 서버 측 웹 게이트웨이 역할
    - USER와 PASS 명령을 보내서 서버에 로그인한다.
    - 서버에서 적절한 디렉터리로 변경하기위해 CWD 명령을 내린다.
    - 다운로드 형식을 ASCII로 설정한다.
    - MDTM으로 문서의 최근 수정 시간을 가져온다.
    - PASV로 서버에게 수동형 데이터 검색을 하겠다고 말한다.
    - RETR로 객체를 검색한다.
    - 제어 채널에서 반환된 포트로 FTP 서버에 데이터 커넥션을 맺고, 데이터 채널이 열리는 대로, 객체가 게이트웨이로 전송

### 8.2.2. HTTP/HTTPS: 서버 측 보안 게이트웨이
- 기업 내부의 모든 웹 요청을 암호화함으로써 개인 정보 보호와 보안을 제공하는데 게이트웨이를 사용
- 클라이언트는 일반 HTTP를 사용하여 웹을 탐색 할 수 있지만, 게이트웨이는 자동으로 사용자의 모든 세션을 암호화
<img src = "https://image.slidesharecdn.com/chap8-160326041513/95/chap8-http-8-10-638.jpg?cb=1458965797">

### 8.2.2. HTTP/HTTPS: 클라이언트 측 보안 가속 게이트웨이
- HTTP/HTTPS 게이트웨이는 보안 가속기로 유명
- 웹 서버의 앞단에 위치하고, 인터셉트 게이트웨이나 리버스 프락시 역할을 한다.
- 보안 HTTPS 트래픽을 받아서 복호화하고, 웹 서버로 보낼 일반 HTTP 요청을 만듬
- 보안 트래픽을 복호화하는 암호화 하드웨어를 내장해서 원 서버의 부화를 줄인다.
- but, 게이트웨이와 원서버간에는 암호화 되지 않은 상태로 통신이 되기 때문에 안전한지 사전 확인후 사용해야함
<img src = "https://image.slidesharecdn.com/chap8-160326041513/95/chap8-http-8-11-638.jpg?cb=1458965797">


## 8.3. 리소스 게이트웨이
- 게이트웨이를 통해여 받을 수 있는 리소스 요청이 들어오면, 서버는 헬퍼 애플리케이션을 생성하여 요청을 처리
    - 헬퍼 애플리케이션은 필요한 데이터를 전달 받음( ex) 쿼리 스트링, 요청 전체 등등) 
<img src = "https://image.slidesharecdn.com/chap8-160326041513/95/chap8-http-8-14-638.jpg?cb=1458965797">

### 8.3.1. 공용 게이트웨이 인터페이스
- CGI(Common Gateway Interface, CGI)는 최초의 서버 확장이자 지금까지도 가자 널리 쓰이는 서버 확장이다.
    - HTML, 신용카드 처리, 데이터페이스 질의..etc
- 거의 모든 HTTP서버가 지원
- 서버와 CGI 애플리케이션 간에 진행되는 처리 단계를 감춤 > 유일하게 쿼리스트링 or 'cgi'만 클라이언트가 알수 있음
- CGI요청마다 프로세스를 만들면 너무 느린 단점이 있으나 <b>FastCGI</b>가 개발되어서 데몬으로 모두 처리 및 성능 개선
### 8.3.2. 서버 확장 API
- 서버 자체의 동작을 바꾸고 싶거나 서버의 처리능력을 최고치로 끌어 올리고자 할때 사용
- 마이크로소프트, 네스케이프, 아피치 등에서 제공
- 마이크로소프트 > 프론트페이지 서버확장(FrontPage Server Extension, FPSE)

## 8.4. 애플리케이션 인터페이스와 웹 서비스
> 웹서비스 : 원래 명칭은 독립형 웹어플리케이션 자체이지만 여기서 말하는것은 애플리케이션이 정보를 공유하는데 사용하는 새로운 매커니즘을 의미이고, HTTP 같은 표준 웹 기술 위에서 개발<br>
    ex) REST, SOAP 등등

## 8.5. 터널
> 웹 터널 : HTTP 프로토콜을 지원하지 않는 애플리케이션에 HTTP 애플리케이션을 사용해 접근하는 방법을 제공
- HTTP 커넥션을 통해서 HTTP가 아닌 트래픽을 전송할 수 있고, 다른 프로토콜을 HTTP 위에 올릴 수 있음
- 사용하는 가장 일반적인 이유는 HTTP 커넥션을 통해서 HTTP가 아닌 다른 트래픽을 얹기 위함
- 웹 트래픽만을 허락하는 방화벽이 있더라도 HTTP가 아닌 트래픽을 전송할수 있음

### 8.5.1. CONNECT로 HTTP 터널 커넥션 맺기
- CONNECT 메서드는 터널 게이트웨이가 임의으 목적 서버와 포트에 TCP 커넥션을 맺고 클라이언트와 서버 간에 오는 데이터를 무조건 전달하기를 요청
<img src = "https://image.slidesharecdn.com/chap8-160326041513/95/chap8-http-8-23-638.jpg?cb=1458965797">

### 8.5.2. 데이터 터널링, 시간, 커넥션 관리
- 터널을 통해서 전달되는 데이터는 게이트웨이에서 볼 수 없고, 패킷의 순서나 흐름에 대한 어떤 가정도 할수 없음
- 클라이언트는 성능을 높이기위해 CONNECT 요청을 보낸 후, 응답이 오기전에 데이터를 터널을 통해서 바로 전송 할수 있는데, 200외의 응답이 왔을경우를 대비하여 다시 보낼 준비를 하여야한다.

### 8.5.3. SSL 터널링
- 웹 터널은 원래 방화벽을 통해서 암호화된 SSL 트래픽을 전달하려고 개발됨
- 많은 회사들이 보안을 위해 모든 트래픽이 패킷을 필터링하는 라우터와 프락시를 지나도록 하였지만, SSL 같은경우는 낡은 방식의 프락시는 처리가 되지 않으므로, 웹터널을 사용하여 SSL 트레픽은 방화벽을 통과시킬수 있음<br>
<img src = "https://image.slidesharecdn.com/chap8-160326041513/95/chap8-http-8-24-638.jpg?cb=1458965797">
### 8.5.4. SSL 터널링 vs HTTP/HTTPS 게이트웨이
- HTTP/HTTPS
    - 클라이언트와 게이트웨이 사이에는 HTTP커넥션이라서 보안성이 없음
    - 프락시가 인증을 담당하고 있기 떄문에, 클라이언트는 원격서버에 SSL 클라이언트 인증(X509)을 할 수 없다.?
- SSL 터널링
    - 프락시에 SSL 구현할 필요없음

### 8.5.5. 터널 인증
- 터널에서 프락시 인증 기능을 추가하여 클라이언트가 터널을 사용할수 있는 권한을 검사하는 용도로도 사용가능
### 8.5.6. 터널 보안에 대한 고려사항들
- 게이트웨이는 HTTPS 전용 포트인 443같이 잘알려진 특정 포트만 터널링 할수 있게 허용해야함
    - 악의적으로 쓰는놈들때문에...
## 8.6. 릴레이
- Http 명세를 완전히준수하지는 않는 간단한 HTTP 프락시
